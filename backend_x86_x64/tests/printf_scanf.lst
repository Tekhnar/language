     1                                  ; Written on nasm + ld + WinAPI
     2                                  
     3                                  ;	./nasm printf_scanf.asm -f win64 -l printf_scanf.lst
     4                                  ;	./ld64 printf_scanf.obj user32.dll kernel32.dll
     5                                  
     6                                  
     7                                  extern GetStdHandle
     8                                  extern WriteConsoleA
     9                                  extern ReadConsoleA
    10                                  extern ExitProcess
    11                                  
    12                                  global Start
    13                                  
    14                                  ;STD_OUTPUT_HANDLE	equ	-11
    15                                  
    16                                  section .data
    17 00000000 48656C6C6F2C20776F-     text	db	"Hello, world!\n"
    17 00000009 726C64215C6E       
    18                                  
    19                                  
    20                                  section .text
    21                                  Start:        
    22                                  
    23                                  ;----------------SCANF----------------
    24 00000000 83E4F0                  		and esp, ~0xf
    25                                  		
    26 00000003 4883EC20                		sub rsp, 32				;	new 32 bytes of shadow space
    27 00000007 48C7C1F6FFFFFF          		mov rcx, -10
    28 0000000E E8(00000000)            		call GetStdHandle
    29 00000013 4889C1                  		mov rcx, rax
    30 00000016 4883C420                		add rsp, 32
    31                                  		
    32 0000001A 4883EC08                		sub rsp, 8
    33 0000001E 4889E7                  		mov rdi, rsp
    34 00000021 4883EC08                		sub rsp, 8
    35 00000025 4889E6                  		mov rsi, rsp
    36                                  		
    37 00000028 4883EC30                		sub rsp, 32 + 8 + 8
    38 0000002C C744242000000000        		mov dword[rsp+32], 0
    39 00000034 4989F1                  		mov r9,rsi
    40 00000037 41B808000000            		mov r8, 8
    41 0000003D 4889FA                  		mov rdx, rdi
    42 00000040 E8(00000000)            		call ReadConsoleA
    43 00000045 4883C430                		add rsp, 48
    44 00000049 4883C408                		add rsp, 8
    45                                  		
    46                                  ;----------------SCANF----------------
    47                                  		
    48                                  ;---------------PRINTF----------------	
    49 0000004D 4883EC20                		sub rsp, 32
    50 00000051 48C7C1F5FFFFFF          		mov rcx, -11
    51 00000058 E8(00000000)            		call GetStdHandle
    52 0000005D 4889C1                  		mov rcx, rax		
    53 00000060 4883C420                		add rsp, 32				;	end of shadow space
    54                                  
    55 00000064 4883EC28                		sub rsp, 32 + 8			;	new 32 bytes of shadow space 
    56 00000068 C744242000000000        		mov dword [rsp + 32], 0
    57 00000070 4989F1                  		mov r9, rsi
    58 00000073 41B80A000000            		mov r8, 10
    59 00000079 4889FA                  		mov rdx, rdi
    60 0000007C E8(00000000)            		call WriteConsoleA
    61                                  		
    62 00000081 4883C430                		add rsp, 48
    63                                  		
    64                                  ;----------------EXIT-----------------
    65 00000085 4831C9                  		xor rcx, rcx
    66 00000088 E8(00000000)            		call ExitProcess
    67                                  	
